<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.Cursor?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressIndicator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<AnchorPane stylesheets="@../../../css/main.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.wakeb.yusradmin.controllers.OverviewController">

    <VBox alignment="TOP_RIGHT" nodeOrientation="RIGHT_TO_LEFT" spacing="12"
          AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0"
          AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">

        <!-- Header -->
        <HBox alignment="CENTER_RIGHT">
            <Label prefHeight="126.0" prefWidth="1020.0" styleClass="title" text="نظرة عامة">
                <HBox.margin><Insets left="30.0" /></HBox.margin>
            </Label>
            <Region HBox.hgrow="ALWAYS"/>
            <Button onAction="#refreshData" prefHeight="38.0" prefWidth="114.0" styleClass="button" text="تحديث">
                <HBox.margin><Insets right="20.0"/></HBox.margin>
            </Button>
        </HBox>

        <!-- Top Stats Row: Users / Reviews / Places -->
        <HBox fillHeight="true" spacing="20" style="-fx-padding: 0 20 20 20;">
            <!-- Users Card -->
            <VBox alignment="TOP_RIGHT" maxWidth="Infinity" styleClass="stat-card" HBox.hgrow="ALWAYS">
                <Label alignment="TOP_LEFT" contentDisplay="TOP" nodeOrientation="RIGHT_TO_LEFT" prefHeight="27.0"
                       prefWidth="343.0" styleClass="stat-title" text="عدد الحسابات المسجلة" textAlignment="RIGHT">
                    <cursor><Cursor fx:constant="NONE"/></cursor>
                </Label>
                <Label fx:id="registeredUsersLabel" alignment="TOP_LEFT" prefHeight="50.0" prefWidth="385.0"
                       styleClass="stat-num-value" text="0">
                    <font><Font size="46.0"/></font>
                </Label>
                <Label fx:id="registeredUsersLabel1" alignment="TOP_LEFT" layoutX="50.0" layoutY="80.0"
                       prefHeight="22.0" prefWidth="375.0" styleClass="stat-value" text="حساب"/>
            </VBox>

            <!-- Reviews Card -->
            <VBox alignment="TOP_RIGHT" maxWidth="Infinity" styleClass="stat-card" HBox.hgrow="ALWAYS">
                <Label contentDisplay="RIGHT" prefHeight="27.0" prefWidth="400.0" styleClass="stat-title"
                       text="إجمالي التعليقات" textAlignment="RIGHT"/>
                <Label fx:id="totalReviewsLabel" alignment="TOP_LEFT" prefHeight="50.0" prefWidth="385.0"
                       styleClass="stat-num-value" text="0"/>
                <Label fx:id="totalReviewsLabel1" alignment="TOP_LEFT" layoutX="50.0" layoutY="80.0"
                       prefHeight="22.0" prefWidth="375.0" styleClass="stat-value" text="تعليق"/>
            </VBox>

            <!-- Places Card -->
            <VBox alignment="TOP_RIGHT" maxWidth="Infinity" nodeOrientation="RIGHT_TO_LEFT" styleClass="stat-card"
                  HBox.hgrow="ALWAYS">
                <Label contentDisplay="RIGHT" nodeOrientation="RIGHT_TO_LEFT" prefHeight="27.0" prefWidth="861.0"
                       styleClass="stat-title" text="إجمالي الأماكن" textAlignment="RIGHT"/>
                <Label fx:id="totalPlacesLabel" alignment="TOP_LEFT" prefHeight="50.0" prefWidth="385.0"
                       styleClass="stat-num-value" text="0"/>
                <Label fx:id="totalPlacesLabel1" alignment="TOP_LEFT" layoutX="50.0" layoutY="80.0"
                       prefHeight="22.0" prefWidth="375.0" styleClass="stat-value" text="مكان"/>
            </VBox>
        </HBox>

        <!-- Charts Row (no empty spaces; full stretch) -->
        <HBox alignment="CENTER" spacing="20" style="-fx-padding: 0 20 20 20;" fillHeight="true">

            <!-- Category Chart -->
            <VBox styleClass="section-card" maxWidth="Infinity" maxHeight="Infinity"
                  HBox.hgrow="ALWAYS" VBox.vgrow="ALWAYS">
                <HBox alignment="CENTER_RIGHT" spacing="10">
                    <FontIcon iconLiteral="fas-layer-group" iconSize="20"/>
                    <Label styleClass="section-title" text="الأماكن حسب الفئة"/>
                </HBox>

                <!-- Fill card completely -->
                <AnchorPane VBox.vgrow="ALWAYS">
                    <StackPane fx:id="chartHost"
                               AnchorPane.topAnchor="0.0" AnchorPane.rightAnchor="0.0"
                               AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0"
                               style="-fx-background-color: transparent;">
                        <ProgressIndicator fx:id="loading" visible="false"/>
                    </StackPane>
                </AnchorPane>
            </VBox>

            <!-- Top Places Chart -->
            <VBox styleClass="section-card" maxWidth="Infinity" maxHeight="Infinity"
                  HBox.hgrow="ALWAYS" VBox.vgrow="ALWAYS">
                <HBox alignment="CENTER_RIGHT" spacing="10">
                    <FontIcon iconLiteral="fas-chart-bar" iconSize="20"/>
                    <Label styleClass="section-title" text="أفضل 5 أماكن تقييم"/>
                </HBox>

                <!-- Fill card completely -->
                <AnchorPane VBox.vgrow="ALWAYS">
                    <StackPane fx:id="topPlacesChartHost"
                               AnchorPane.topAnchor="0.0" AnchorPane.rightAnchor="0.0"
                               AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0"
                               style="-fx-background-color: transparent;">
                        <ProgressIndicator visible="false"/>
                    </StackPane>
                </AnchorPane>
            </VBox>

        </HBox>

        <!-- Latest Reviews (FULL-WIDTH & CLEAN) -->
        <VBox styleClass="section-card" maxWidth="Infinity" style="-fx-padding: 0 20 20 20;">
            <HBox alignment="CENTER_RIGHT" spacing="10">
                <FontIcon iconLiteral="fas-clock" iconSize="20"/>
                <Label styleClass="section-title" text="أحدث التعليقات"/>
            </HBox>

            <!-- يجعل الجدول يشغل كل المساحة داخل الكارد -->
            <AnchorPane VBox.vgrow="ALWAYS">
                <TableView fx:id="reviewsTableView"
                           AnchorPane.topAnchor="0.0" AnchorPane.rightAnchor="0.0"
                           AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0"
                           nodeOrientation="RIGHT_TO_LEFT"
                           fixedCellSize="34.0"
                           tableMenuButtonVisible="false">

                    <!-- هنا الطريقة الصحيحة لتمرير الثابت -->
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>

                    <!-- Placeholder عند عدم وجود بيانات -->
                    <placeholder>
                        <Label text="لا توجد تعليقات حالياً" />
                    </placeholder>

                    <columns>
                        <TableColumn text="المستخدم" minWidth="120" prefWidth="140" style="-fx-alignment: CENTER-RIGHT;">
                            <cellValueFactory><PropertyValueFactory property="userName"/></cellValueFactory>
                        </TableColumn>

                        <TableColumn text="المكان" minWidth="150" prefWidth="180" style="-fx-alignment: CENTER-RIGHT;">
                            <cellValueFactory><PropertyValueFactory property="placeName"/></cellValueFactory>
                        </TableColumn>

                        <TableColumn text="التعليق" minWidth="260" prefWidth="400" style="-fx-alignment: CENTER-RIGHT;">
                            <cellValueFactory><PropertyValueFactory property="description"/></cellValueFactory>
                        </TableColumn>

                        <TableColumn text="التقييم" minWidth="90" prefWidth="100" style="-fx-alignment: CENTER;">
                            <cellValueFactory><PropertyValueFactory property="rating"/></cellValueFactory>
                        </TableColumn>

                        <TableColumn text="التاريخ" minWidth="140" prefWidth="160" style="-fx-alignment: CENTER; ">
                            <cellValueFactory><PropertyValueFactory property="reviewDate"/></cellValueFactory>
                        </TableColumn>
                    </columns>
                </TableView>
            </AnchorPane>
        </VBox>

    </VBox>
</AnchorPane>
