<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.control.ProgressIndicator?>
<VBox alignment="TOP_RIGHT" nodeOrientation="RIGHT_TO_LEFT" spacing="12" stylesheets="@../../../css/main.css" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.wakeb.yusradmin.controllers.OverviewController">

    <HBox alignment="CENTER_RIGHT">
        <Label styleClass="title" text="نظرة عامة" />
        <Region HBox.hgrow="ALWAYS" />
        <Button onAction="#refreshData" styleClass="button" text="تحديث">
            <graphic>
                <FontIcon iconLiteral="fas-sync-alt" iconSize="14" />
            </graphic>
        </Button>
    </HBox>

    <VBox spacing="20" style="-fx-padding: 20;">
        <!-- Statistics Cards -->
        <HBox alignment="CENTER" spacing="20">
            <!-- Users Card -->
            <VBox styleClass="stat-card">
                <HBox alignment="CENTER" spacing="10">
                    <FontIcon iconLiteral="fas-users" iconSize="24" styleClass="stat-icon" />
                    <Label styleClass="stat-title" text="عدد الحسابات المسجلة" />
                </HBox>
                <Label fx:id="registeredUsersLabel" styleClass="stat-value" text="0 حساب" />
            </VBox>

            <!-- Reviews Card -->
            <VBox styleClass="stat-card">
                <HBox alignment="CENTER" spacing="10">
                    <FontIcon iconLiteral="fas-star" iconSize="24" styleClass="stat-icon" />
                    <Label prefHeight="27.0" prefWidth="140.0" styleClass="stat-title" text="إجمالي التعليقات" />
                </HBox>
                <Label fx:id="totalReviewsLabel" styleClass="stat-value" text="0 تعليق" />
            </VBox>

            <!-- Places Card -->
            <VBox styleClass="stat-card">
                <HBox alignment="CENTER" spacing="10">
                    <FontIcon iconLiteral="fas-map-marker-alt" iconSize="24" styleClass="stat-icon" />
                    <Label styleClass="stat-title" text="إجمالي الأماكن" />
                </HBox>
                <Label fx:id="totalPlacesLabel" styleClass="stat-value" text="0 مكان" />
            </VBox>
        </HBox>

        <!-- Category Statistics Row -->
        <HBox alignment="CENTER" spacing="10.0">
            <!-- Chart Section (Replaces the Places by Category table) -->
            <VBox styleClass="section-card" prefWidth="400">
                <HBox alignment="CENTER_RIGHT" spacing="10">
                    <FontIcon iconLiteral="fas-layer-group" iconSize="20" />
                    <Label styleClass="section-title" text="الأماكن حسب الفئة" />
                </HBox>
                <StackPane fx:id="chartHost" prefHeight="380" style="-fx-background-color: transparent;">
                    <ProgressIndicator fx:id="loading" visible="false"/>
                </StackPane>
            </VBox>

            <!-- Top Places Table -->
            <VBox styleClass="section-card" prefWidth="400">
                <HBox alignment="CENTER_RIGHT" spacing="10">
                    <FontIcon iconLiteral="fas-chart-bar" iconSize="20" />
                    <Label styleClass="section-title" text="أفضل 5 أماكن تقييم" />
                </HBox>
                <StackPane fx:id="topPlacesChartHost" prefHeight="380" style="-fx-background-color: transparent;">
                    <ProgressIndicator visible="false"/>
                </StackPane>
            </VBox>
        </HBox>

        <!-- Latest Reviews -->
        <VBox styleClass="section-card">
            <HBox alignment="CENTER_RIGHT" spacing="10">
                <FontIcon iconLiteral="fas-clock" iconSize="20" text="" />
                <Label styleClass="section-title" text="أحدث التعليقات" />
            </HBox>
            <TableView fx:id="reviewsTableView" style="-fx-max-height: 300;">
                <columns>
                    <TableColumn prefWidth="120" text="المستخدم">
                        <cellValueFactory><PropertyValueFactory property="userName" /></cellValueFactory>
                    </TableColumn>
                    <TableColumn prefWidth="150" text="المكان">
                        <cellValueFactory><PropertyValueFactory property="placeName" /></cellValueFactory>
                    </TableColumn>
                    <TableColumn prefWidth="200" text="التعليق">
                        <cellValueFactory><PropertyValueFactory property="description" /></cellValueFactory>
                    </TableColumn>
                    <TableColumn prefWidth="80" text="التقييم">
                        <cellValueFactory><PropertyValueFactory property="rating" /></cellValueFactory>
                    </TableColumn>
                    <TableColumn prefWidth="120" text="التاريخ">
                        <cellValueFactory><PropertyValueFactory property="createdAt" /></cellValueFactory>
                    </TableColumn>
                </columns>
            </TableView>
        </VBox>
    </VBox>
</VBox>